<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sign Up - Stellest AI</title>
    <style>
        :root{--bg:#000;--panel:#111;--field:#1a1a1a;--text:#fff;--muted:#aaa;--border:#333;--accent:#fff}
        *{box-sizing:border-box;margin:0;padding:0}
        body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,sans-serif;background:var(--bg);color:var(--text);min-height:100vh;display:flex;align-items:center;justify-content:center;padding:24px}
        .card{width:100%;max-width:480px;background:var(--panel);border:1px solid var(--border);border-radius:16px;padding:24px}
        h1{font-size:1.75rem;margin-bottom:8px}
        p{color:var(--muted);margin-bottom:24px}
        .grid{display:grid;grid-template-columns:1fr 1fr;gap:12px}
        .field{display:flex;flex-direction:column;gap:8px;margin-bottom:16px}
        label{font-weight:600}
        input{background:var(--field);border:1px solid var(--border);border-radius:10px;color:var(--text);padding:12px;font-size:1rem}
        input:focus{outline:none;border-color:var(--accent)}
        .btn{width:100%;background:var(--accent);color:var(--bg);border:none;border-radius:10px;padding:12px 16px;font-weight:700;cursor:pointer}
        .row{display:flex;justify-content:space-between;align-items:center;margin-top:12px}
        a{color:var(--accent);text-decoration:none}
        .error{color:#ff7272;margin-top:12px;display:none}
        @media (max-width:640px){.grid{grid-template-columns:1fr}}
    </style>
</head>
<body>
    <div class="card">
        <div class="logo">ðŸ”¬ Stellest AI</div>
        <h1>Create your account</h1>
        <p>Sign up to access the prediction platform.</p>
        <form id="signupForm">
            <div class="grid">
                <div class="field">
                    <label for="firstName">First name</label>
                    <input id="firstName" name="firstName" required placeholder="John" />
                </div>
                <div class="field">
                    <label for="lastName">Last name</label>
                    <input id="lastName" name="lastName" required placeholder="Doe" />
                </div>
            </div>
            <div class="field">
                <label for="email">Email</label>
                <input id="email" name="email" type="email" required placeholder="you@example.com" />
            </div>
            <div class="field">
                <label for="password">Password</label>
                <input id="password" name="password" type="password" required placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢" />
            </div>
            <button class="btn" id="signupBtn" type="submit">Create account</button>
            <div class="row">
                <span style="color:var(--muted);font-size:.95rem">Have an account?</span>
                <a href="/signin">Sign in</a>
            </div>
            <div id="error" class="error">Please fill all fields</div>
        </form>
    </div>

    <script src="/supabase-config.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script>
        if (localStorage.getItem('stellest_token')) {
            window.location.replace('/');
        }

        const form = document.getElementById('signupForm');
        const btn = document.getElementById('signupBtn');
        const err = document.getElementById('error');

        const supabaseConfig = window.SUPABASE_CONFIG;
        let supabaseClient = null;
        if (supabaseConfig && window.supabase) {
            supabaseClient = window.supabase.createClient(supabaseConfig.url, supabaseConfig.anonKey);
        }

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            err.style.display = 'none';
            btn.disabled = true; btn.textContent = 'Creating...';

            const firstName = document.getElementById('firstName').value.trim();
            const lastName = document.getElementById('lastName').value.trim();
            const email = document.getElementById('email').value.trim();
            const password = document.getElementById('password').value;

            if (!firstName || !lastName || !email || !password) {
                err.style.display = 'block';
                btn.disabled = false; btn.textContent = 'Create account';
                return;
            }

            try {
                if (!supabaseClient) throw new Error('Supabase not configured');
                const { data, error } = await supabaseClient.auth.signUp({
                    email, password,
                    options: {
                        data: { firstName, lastName }
                    }
                });
                if (error) throw error;
                // Supabase may require email confirmation; handle both cases
                if (data.session && data.session.access_token) {
                    localStorage.setItem('stellest_token', data.session.access_token);
                    localStorage.setItem('stellest_user', JSON.stringify({ firstName, lastName, email, provider: 'password' }));
                    window.location.replace('/');
                } else {
                    alert('Check your email to confirm your account, then sign in.');
                    window.location.replace('/signin');
                }
            } catch (e) {
                console.error(e);
                err.textContent = e.message || 'Sign-up failed';
                err.style.display = 'block';
                btn.disabled = false; btn.textContent = 'Create account';
            }
        });
    </script>
</body>
</html>
